(function(){var r,t;r=function(){function r(r){"function"==typeof r&&this.draw(r)}var t,e,n,a,i,o,u,p,s;return n=/:([\w\d]+)/g,p=/\*\w+/g,a="([^/]+)",s="(.*)",u=function(r){var t;return t=/[\-{}\[\]+?.,\\\^$|#\s]/g,r=r.replace(t,"\\$&").replace(n,a).replace(p,s),RegExp("^"+r+"$","i")},e=function(r){var t,e,n,a;for(e=/[:|\*]([\w\d]+)/g,a=[];t=e.exec(r);)a.push(n=t[1]);return a},i=function(r){var e,n,a,i,o,u,p;if(i={},null!=r)for(o=/[\?&]([^=&]+)=?([^&$]+)?/g;n=o.exec(r);){for(e=u=1;2>=u;e=++u)null!=n[e]&&(n[e]=t(n[e]));/\[\]$/.test(n[1])?(a=n[1].replace(/\[\]$/,""),null==(p=i[a])&&(i[a]=[]),i[a].push(n[2])):i[n[1]]=n[2]}return i},o=function(r,t){return null==t&&(t=1),r[r.length-t]},t=function(r){return null==r?r:decodeURIComponent(r.replace("+","%20"))},r.prototype.draw=function(r){return r.call(this)},r.prototype.map=function(r,t){var e,n,a;if(null==(n=this.mappings)&&(this.mappings=[]),"string"!=typeof r)throw Error("route must be a string");if("function"!=typeof t)throw Error("callback must be a function");return null==(a=this._prefix_stack)&&(this._prefix_stack=[]),e=(o(this._prefix_stack)||"")+r,this.mappings.push({route:e,callback:t})},r.prototype.route=function(r,t){var e,n,a,i,o,u,p,s,l;for(s=this.mappings,l=[],u=0,p=s.length;p>u;u++){if(n=s[u],a=this.scan(r,n.route)){if(null!=t){i=t.params,delete t.params;for(e in t)o=t[e],a[e]=o;if(null!=i&&null==a.params)a.params=i;else for(e in i)o=i[e],a.params[e]=o}n.callback(a);break}l.push(void 0)}return l},r.prototype.routeRequest=function(r){var t,e,n;null==r&&(r=window.location),e={},null!=r.search&&(e.params=i(r.search));for(t in r)n=r[t],e[t]=n;return this.route(r.pathname,e)},r.prototype.scan=function(r,n,a){var i,o,p,s,l,c,f,h;if(null==a&&(a={}),a.regexp=a.regexp||u(n),!a.regexp.test(r))return!1;for(i=a.regexp.exec(r),a.param_names=a.param_names||e(n),l={},h=a.param_names,o=c=0,f=h.length;f>c;o=++c)s=h[o],l[s]=t(i[o+1]);return p={params:l}},r.prototype.namespace=function(r,t){var e;return null==(e=this._prefix_stack)&&(this._prefix_stack=[]),this._prefix_stack.push((o(this._prefix_stack)||"")+r),t.call(this),this._prefix_stack.pop()},r}(),t!==void 0&&null!==t?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(t=module.exports=r),t.Cartograph=r):"function"==typeof define&&define.amd?define(function(){return r}):this.Cartograph=r}).call(this);