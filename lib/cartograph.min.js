(function(){var r,t;r=function(){function r(r){"function"==typeof r&&this.draw(r)}var t,e,n,a,i,o,p;return e=/:([\w\d]+)/g,p=/\*/g,a=function(r){var t,e;return t="([^/]+)",e=".*",i(r,t,e)},o=function(r){var t,e;return t="[^/]+",e="(.*)",i(r,t,e)},i=function(r,t,n){var a;return a=/[\-{}\[\]+?.,\\\^$|#\s]/g,r=r.replace(a,"\\$&").replace(e,t).replace(p,n),RegExp("^"+r+"$","i")},t=function(r){var t,e,n,a;for(e=/[:|\*]([\w\d]+)/g,a=[];t=e.exec(r);)a.push(n=t[1]);return a},n=function(r){var t,e,n;if(e={},null!=r)for(n=/[\?&]([^=&]+)=?([^&$]+)?/g;t=n.exec(r);)e[t[1]]=t[2];return e},r.prototype.draw=function(r){return r.call(this)},r.prototype.map=function(r,t){var e,n;if(null==(e=this.mappings)&&(this.mappings=[]),"string"!=typeof r)throw Error("route must be a string");if("function"!=typeof t)throw Error("callback must be a function");return null==(n=this._prefix)&&(this._prefix=""),this.mappings.push({route:this._prefix+r,callback:t})},r.prototype.match=function(r,t){var e,n,a,i,o,p,u,s,l;for(s=this.mappings,l=[],p=0,u=s.length;u>p;p++){if(n=s[p],a=this.scan(r,n.route)){if(null!=t){i=t.params,delete t.params;for(e in t)o=t[e],a[e]=o;if(null!=i&&null==a.params)a.params=i;else for(e in i)o=i[e],a.params[e]=o}n.callback(a);break}l.push(void 0)}return l},r.prototype.matchRequest=function(r){var t,e,a;null==r&&(r=window.location),e={},null!=r.search&&(e.params=n(r.search));for(t in r)a=r[t],e[t]=a;return this.match(r.pathname,e)},r.prototype.scan=function(r,e,n){var i,p,u,s,l,f,c,h,m,g,d;if(null==n&&(n={}),f=n.param_regexp||a(e),n.param_regexp=f,!f.test(r))return!1;for(m=n.splat_regexp||o(e),n.splat_regexp=m,s=f.exec(r),h=m.exec(r),l=n.param_names||t(e),n.param_names=l,c={},i=g=0,d=l.length;d>g;i=++g)u=l[i],c[u]=s[i+1];return c.splats=h.slice(1),p={params:c}},r.prototype.namespace=function(r,t){var e;return e=this._prefix||"",this._prefix+=r,t.call(this),this._prefix=e},r}(),t!==void 0&&null!==t?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(t=module.exports=r),t.Cartograph=r):"function"==typeof define&&define.amd?define(function(){return r}):this.Cartograph=r}).call(this);