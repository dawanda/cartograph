(function(){var r,e;r=function(){function r(r){"function"==typeof r&&this.draw(r)}var e,t,n,a,i,p,o,s;return t=/:([\w\d]+)/g,s=/\*/g,i=function(r){var e,t;return e="([^/]+)",t=".*",p(r,e,t)},o=function(r){var e,t;return e="[^/]+",t="(.*)",p(r,e,t)},p=function(r,e,n){var a;return a=/[\-{}\[\]+?.,\\\^$|#\s]/g,r=r.replace(a,"\\$&").replace(t,e).replace(s,n),RegExp("^"+r+"$","i")},e=function(r){var e,t,n,a;for(t=/[:|\*]([\w\d]+)/g,a=[];e=t.exec(r);)a.push(n=e[1]);return a},n=function(r){var e,t,n;if(t={},null!=r)for(n=/[\?&]([^=&]+)=?([^&$]+)?/g;e=n.exec(r);)t[e[1]]=e[2];return t},a=function(r,e){return null==e&&(e=1),r[r.length-e]},r.prototype.draw=function(r){return r.call(this)},r.prototype.map=function(r,e){var t,n,i;if(null==(n=this.mappings)&&(this.mappings=[]),"string"!=typeof r)throw Error("route must be a string");if("function"!=typeof e)throw Error("callback must be a function");return null==(i=this._prefixes)&&(this._prefixes=[]),t=(a(this._prefixes)||"")+r,this.mappings.push({route:t,callback:e})},r.prototype.match=function(r,e){var t,n,a,i,p,o,s,u,l;for(u=this.mappings,l=[],o=0,s=u.length;s>o;o++){if(n=u[o],a=this.scan(r,n.route)){if(null!=e){i=e.params,delete e.params;for(t in e)p=e[t],a[t]=p;if(null!=i&&null==a.params)a.params=i;else for(t in i)p=i[t],a.params[t]=p}n.callback(a);break}l.push(void 0)}return l},r.prototype.matchRequest=function(r){var e,t,a;null==r&&(r=window.location),t={},null!=r.search&&(t.params=n(r.search));for(e in r)a=r[e],t[e]=a;return this.match(r.pathname,t)},r.prototype.scan=function(r,t,n){var a,p,s,u,l,f,c,h,m,g,x;if(null==n&&(n={}),f=n.param_regexp||i(t),n.param_regexp=f,!f.test(r))return!1;for(m=n.splat_regexp||o(t),n.splat_regexp=m,u=f.exec(r),h=m.exec(r),l=n.param_names||e(t),n.param_names=l,c={},a=g=0,x=l.length;x>g;a=++g)s=l[a],c[s]=u[a+1];return c.splats=h.slice(1),p={params:c}},r.prototype.namespace=function(r,e){var t;return null==(t=this._prefixes)&&(this._prefixes=[]),this._prefixes.push((a(this._prefixes)||"")+r),e.call(this),this._prefixes.pop},r}(),e!==void 0&&null!==e?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(e=module.exports=r),e.Cartograph=r):"function"==typeof define&&define.amd?define(function(){return r}):this.Cartograph=r}).call(this);