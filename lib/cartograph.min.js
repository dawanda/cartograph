(function(){var e,t;e=function(){function e(e){"function"==typeof e&&this.draw(e)}var t,r,n,a,o,i,p,u;return r=/:([\w\d]+)/g,p=/\*\w+/g,n="([^/]+)",u="(.*)",i=function(e){var t;return t=/[\-{}\[\]+?.,\\\^$|#\s]/g,e=e.replace(t,"\\$&").replace(r,n).replace(p,u),RegExp("^"+e+"$","i")},t=function(e){var t,r,n,a;for(r=/[:|\*]([\w\d]+)/g,a=[];t=r.exec(e);)a.push(n=t[1]);return a},a=function(e){var t,r,n,a,o,i,p;if(a={},null!=e)for(o=/[\?&]([^=&]+)=?([^&$]+)?/g;r=o.exec(e);){for(t=i=1;2>=i;t=++i)null!=r[t]&&(r[t]=decodeURIComponent(r[t]));/\[\]$/.test(r[1])?(n=r[1].replace(/\[\]$/,""),null==(p=a[n])&&(a[n]=[]),a[n].push(r[2])):a[r[1]]=r[2]}return a},o=function(e,t){return null==t&&(t=1),e[e.length-t]},e.prototype.draw=function(e){return e.call(this)},e.prototype.map=function(e,t){var r,n,a;if(null==(n=this.mappings)&&(this.mappings=[]),"string"!=typeof e)throw Error("route must be a string");if("function"!=typeof t)throw Error("callback must be a function");return null==(a=this._prefix_stack)&&(this._prefix_stack=[]),r=(o(this._prefix_stack)||"")+e,this.mappings.push({route:r,callback:t})},e.prototype.route=function(e,t){var r,n,a,o,i,p,u,s,l;for(s=this.mappings,l=[],p=0,u=s.length;u>p;p++){if(n=s[p],a=this.scan(e,n.route)){if(null!=t){o=t.params,delete t.params;for(r in t)i=t[r],a[r]=i;if(null!=o&&null==a.params)a.params=o;else for(r in o)i=o[r],a.params[r]=i}n.callback(a);break}l.push(void 0)}return l},e.prototype.routeRequest=function(e){var t,r,n;null==e&&(e=window.location),r={},null!=e.search&&(r.params=a(e.search));for(t in e)n=e[t],r[t]=n;return this.route(e.pathname,r)},e.prototype.scan=function(e,r,n){var a,o,p,u,s,l,c,f;if(null==n&&(n={}),n.regexp=n.regexp||i(r),!n.regexp.test(e))return!1;for(a=n.regexp.exec(e),n.param_names=n.param_names||t(r),s={},f=n.param_names,o=l=0,c=f.length;c>l;o=++l)u=f[o],s[u]=decodeURIComponent(a[o+1]);return p={params:s}},e.prototype.namespace=function(e,t){var r;return null==(r=this._prefix_stack)&&(this._prefix_stack=[]),this._prefix_stack.push((o(this._prefix_stack)||"")+e),t.call(this),this._prefix_stack.pop()},e}(),t!==void 0&&null!==t?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(t=module.exports=e),t.Cartograph=e):"function"==typeof define&&define.amd?define(function(){return e}):this.Cartograph=e}).call(this);