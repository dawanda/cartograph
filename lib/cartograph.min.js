(function(){var r,e;r=function(){function r(r){"function"==typeof r&&this.draw(r)}var e,t,n,a,o,u,i,p,l,s;return a=/:([\w\d]+)/g,l=/\*\w+/g,o="([^/]+)",s="(.*)",p=function(r){var e;return e=/[\-{}\[\]+?.,\\\^$|#\s]/g,r=r.replace(e,"\\$&").replace(a,o).replace(l,s),RegExp("^"+r+"$","i")},t=function(r){var e,t,n,a;for(t=/[:|\*]([\w\d]+)/g,a=[];e=t.exec(r);)a.push(n=e[1]);return a},n=function(r,e,t,n){var a,o,u,i,p,l,s,c,f,h;for(l=/^([^\[]+)(\[|$)/,i=/\[([^\]]+)\]/g,p=null!=(f=l.exec(e))?f[1]:void 0,u=[p];o=i.exec(e);)u.push(o[1]);for(a=u.pop(),s=0,c=u.length;c>s;s++)o=u[s],null==(h=r[o])&&(r[o]={}),r=r[o];return(n||null==r[a])&&(r[a]=t),r[a]},u=function(r){var t,a,o,u,i,p,l;if(i={},null!=r)for(p=/[\?&]([^=&]+)=?([^&$]+)?/g;a=p.exec(r);){for(t=l=1;2>=l;t=++l)null!=a[t]&&(a[t]=e(a[t]));/\[\]$/.test(a[1])?(o=a[1].replace(/\[\]$/,""),u=n(i,o,[],!1),u.push(a[2])):n(i,a[1],a[2],!0)}return i},i=function(r,e){return null==e&&(e=1),r[r.length-e]},e=function(r){return null==r?r:decodeURIComponent(r.replace(/\+/g,"%20"))},r.prototype.draw=function(r){return r.call(this)},r.prototype.map=function(r,e){var t,n,a;if(null==(n=this.mappings)&&(this.mappings=[]),"string"!=typeof r)throw Error("route must be a string");if("function"!=typeof e)throw Error("callback must be a function");return null==(a=this._prefix_stack)&&(this._prefix_stack=[]),t=(i(this._prefix_stack)||"")+r,this.mappings.push({route:t,callback:e})},r.prototype.route=function(r,e){var t,n,a,o,u,i,p,l;for(l=this.mappings,i=0,p=l.length;p>i;i++)if(n=l[i],a=this.scan(r,n.route)){if(null!=e){o=e.params,delete e.params;for(t in e)u=e[t],a[t]=u;if(null!=o&&null==a.params)a.params=o;else for(t in o)u=o[t],a.params[t]=u}return n.callback(a)}return null},r.prototype.routeRequest=function(r){var e,t,n;null==r&&(r=window.location),t={},null!=r.search&&(t.params=u(r.search));for(e in r)n=r[e],t[e]=n;return this.route(r.pathname,t)},r.prototype.scan=function(r,n,a){var o,u,i,l,s,c,f,h;if(null==a&&(a={}),a.regexp=a.regexp||p(n),!a.regexp.test(r))return!1;for(o=a.regexp.exec(r),a.param_names=a.param_names||t(n),s={},h=a.param_names,u=c=0,f=h.length;f>c;u=++c)l=h[u],s[l]=e(o[u+1]);return i={params:s}},r.prototype.namespace=function(r,e){var t;return null==(t=this._prefix_stack)&&(this._prefix_stack=[]),this._prefix_stack.push((i(this._prefix_stack)||"")+r),e.call(this),this._prefix_stack.pop()},r}(),e!==void 0&&null!==e?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(e=module.exports=r),e.Cartograph=r):"function"==typeof define&&define.amd?define(function(){return r}):this.Cartograph=r}).call(this);