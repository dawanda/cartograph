(function(){var t,r;t=function(){function t(t){"function"==typeof t&&this.draw(t)}var r,e,n,a,i,p,o,s;return e=/:([\w\d]+)/g,s=/\*/g,i=function(t){var r,e;return r="([^/]+)",e=".*",p(t,r,e)},o=function(t){var r,e;return r="[^/]+",e="(.*)",p(t,r,e)},p=function(t,r,n){var a;return a=/[\-{}\[\]+?.,\\\^$|#\s]/g,t=t.replace(a,"\\$&").replace(e,r).replace(s,n),RegExp("^"+t+"$","i")},r=function(t){var r,e,n,a;for(e=/[:|\*]([\w\d]+)/g,a=[];r=e.exec(t);)a.push(n=r[1]);return a},n=function(t){var r,e,n;if(e={},null!=t)for(n=/[\?&]([^=&]+)=?([^&$]+)?/g;r=n.exec(t);)e[r[1]]=r[2];return e},a=function(t,r){return null==r&&(r=1),t[t.length-r]},t.prototype.draw=function(t){return t.call(this)},t.prototype.map=function(t,r){var e,n,i;if(null==(n=this.mappings)&&(this.mappings=[]),"string"!=typeof t)throw Error("route must be a string");if("function"!=typeof r)throw Error("callback must be a function");return null==(i=this._prefix_stack)&&(this._prefix_stack=[]),e=(a(this._prefix_stack)||"")+t,this.mappings.push({route:e,callback:r})},t.prototype.match=function(t,r){var e,n,a,i,p,o,s,u,l;for(u=this.mappings,l=[],o=0,s=u.length;s>o;o++){if(n=u[o],a=this.scan(t,n.route)){if(null!=r){i=r.params,delete r.params;for(e in r)p=r[e],a[e]=p;if(null!=i&&null==a.params)a.params=i;else for(e in i)p=i[e],a.params[e]=p}n.callback(a);break}l.push(void 0)}return l},t.prototype.matchRequest=function(t){var r,e,a;null==t&&(t=window.location),e={},null!=t.search&&(e.params=n(t.search));for(r in t)a=t[r],e[r]=a;return this.match(t.pathname,e)},t.prototype.scan=function(t,e,n){var a,p,s,u,l,c,f,h,m,_,g;if(null==n&&(n={}),c=n.param_regexp||i(e),n.param_regexp=c,!c.test(t))return!1;for(m=n.splat_regexp||o(e),n.splat_regexp=m,u=c.exec(t),h=m.exec(t),l=n.param_names||r(e),n.param_names=l,f={},a=_=0,g=l.length;g>_;a=++_)s=l[a],f[s]=u[a+1];return f.splats=h.slice(1),p={params:f}},t.prototype.namespace=function(t,r){var e;return null==(e=this._prefix_stack)&&(this._prefix_stack=[]),this._prefix_stack.push((a(this._prefix_stack)||"")+t),r.call(this),this._prefix_stack.pop()},t}(),r!==void 0&&null!==r?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(r=module.exports=t),r.Cartograph=t):"function"==typeof define&&define.amd?define(function(){return t}):this.Cartograph=t}).call(this);